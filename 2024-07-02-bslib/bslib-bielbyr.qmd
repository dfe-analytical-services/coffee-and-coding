---
title: "The bslib R package for creating Shiny dashboards"
title-slide-attributes:
  data-background-position: top
  data-background-image: title-screen-package-logos.png
  data-background-size: contain
  data-background-opacity: "1"
subtitle: "DfE Coffee and Coding"
author: "Rich Bielby, Statistics Development Team"
institute: Department for Education
format:
  revealjs: 
    theme: [dark, custom.scss]
    width: 120%
    height: 120%
    logo: images/DfE_logo_landscape.png
---

```{r echo=FALSE}
# Render me using quarto::quarto_render("2024-07-02-bslib/bslib-bielbyr.qmd")
library(shiny)
library(shinyGovstyle)
library(bslib)
library(bsicons)
library(ggplot2)
library(plotly)
library(styler)
```

```{r echo=FALSE}
example_plot_a <- ggplotly(
  mtcars %>%
    rename(Weight = wt, MPG = mpg) %>%
    ggplot2::ggplot(ggplot2::aes(x = Weight, y = MPG)) +
    ggplot2::geom_point(colour="#801650") +
    ggplot2::theme_classic() +
    theme(
      axis.text = element_text(size = 14),
      axis.title = element_text(size = 16, face = "bold")
    )
)
example_plot_b <- ggplotly(
  mtcars %>%
    ggplot2::ggplot(ggplot2::aes(x = mpg)) +
    ggplot2::geom_histogram(binwidth=2.5, fill="#801650") +
    ggplot2::theme_classic() +
    theme(
      axis.text = element_text(size = 14),
      axis.title = element_text(size = 16, face = "bold")
    )
)
```


## The bslib R package

:::: {.columns}
::: {.column width="60%"}
In this coffee and coding, I'll give a brief introduction to the `bslib` package and what it can offer dashboard builders.

- Bit of background on how `shiny` creates user-interface (webpage) elements.
- How `bslib` complements this
  - Cards
  - Column layouts
  - Valueboxes
  - Accordions

:::
::: {.column width="40%"}
[![](images/bslib-front-page.png){fig-align="right"}](https://rstudio.github.io/bslib/articles/any-project/index.html)
:::
::::

## A brief intro into Shiny UIs

Most of the user-interface building functions in Shiny are just creating some html code. For example you could use html to create all sorts of inputs including text boxes, file uploaders and radio buttons:

::::: {.fragment .fade-in}
:::: {.columns}
::: {.column width="32%"}
### R / Shiny

```{r eval=TRUE, echo=TRUE}
shiny::textInput(
  "text-input-1",
  label = "Text input: "
)
```
:::
::: {.column width="64%"}
### html

```{html eval=FALSE, echo=TRUE}
<div class="form-group shiny-input-container">
  <label class="control-label" id="text-input-1-label" for="text-input-1">Text input: </label>
  <input id="text-input-1" type="text" class="shiny-input-text form-control" value=""/>
</div>
```
:::
::::
:::::

## A brief intro into Shiny UIs

Most of the user-interface building functions in Shiny are just creating some html code. For example you could use html to create all sorts of inputs including text boxes, file uploaders and radio buttons:


:::: {.columns}
::: {.column width="32%"}
### R / Shiny

```{r eval=TRUE, echo=TRUE}
shiny::fileInput(
  "file-upload-1",
  label = "File upload input"
)
```
:::
::: {.column width="64%"}
### html

```{html eval=FALSE, echo=TRUE}
<div class="form-group shiny-input-container">
  <label class="control-label" id="file-upload-1-label" for="file-upload-1">File upload input</label>
  <div class="input-group">
    <label class="input-group-btn input-group-prepend">
      <span class="btn btn-default btn-file">
        Browse...
        <input id="file-upload-1" class="shiny-input-file" name="file-upload-1" type="file" style="position: absolute !important; top: -99999px !important; left: -99999px !important;"/>
      </span>
    </label>
    <input type="text" class="form-control" placeholder="No file selected" readonly="readonly"/>
  </div>
  <div id="file-upload-1_progress" class="progress active shiny-file-input-progress">
    <div class="progress-bar"></div>
  </div>
</div>
```
:::
::::

## A brief intro into Shiny UIs

Most of the user-interface building functions in Shiny are just creating some html code. For example you could use html to create all sorts of inputs including text boxes, file uploaders and radio buttons:

:::: {.columns}
::: {.column width="32%"}
### R / Shiny

```{r echo=TRUE}
shiny::radioButtons(
  "radio-buttons-1",
  choices = c("England", "Switzerland"),
  label = "Some radio buttons"
)
```
:::
::: {.column width="64%"}
### html

```{html eval=FALSE, echo=TRUE}
<div id="radio-buttons-1" class="form-group shiny-input-radiogroup shiny-input-container" role="radiogroup" aria-labelledby="radio-buttons-1-label">
  <label class="control-label" id="radio-buttons-1-label" for="radio-buttons-1">Some radio buttons</label>
  <div class="shiny-options-group">
    <div class="radio">
      <label>
        <input type="radio" name="radio-buttons-1" value="England" checked="checked"/>
        <span>England</span>
      </label>
    </div>
    <div class="radio">
      <label>
        <input type="radio" name="radio-buttons-1" value="Switzerland"/>
        <span>Switzerland</span>
      </label>
    </div>
  </div>
</div>
```
:::
::::


::::: {.fragment .fade-in}
All these Shiny functions use basic `html` code and functionality, but there's a lot more out there that you can use to build attractive, dynamic web content and one of these is **Bootstrap**.
:::::

## What is **Bootstrap**?

:::: {.columns}
::: {.column width="64%"}
**Bootstrap** provides a toolkit of off the shelf **JavaScript** and **css** for building more complex components in webpages above and beyond what you can do with **html**.

[![](bootstrap-frontpage.png){fig-align="center"}](http://www.getbootstrap.com)

:::
::: {.column width="32%"}
[![](images/bootstrap-features.png){fig-align="center"}](http://www.getbootstrap.com)
:::
::::

## Using Bootstrap with Shiny

Just as `Shiny` has functions that can produce html code for you, the `bslib` package does the same with **Bootstrap**. It provides R commands that can automatically generate **Bootstrap** elements to build and produce your webpage.

::::{.columns}
::: {.column width="36%"}
[![](images/bslib-overview.png){fig-align="center"}](https://rstudio.github.io/bslib/index.html)
:::
::: {.column width="24%"}
Some of the most useful functions in `bslib` are:

* `card()`
* `layout_columns()`
* `value_box()`
* `accordion_panel()` / `accordion()`

:::
::: {.column width="36%"}
[![](images/bslib-valueboxes.png){fig-align="center"}](https://rstudio.github.io/bslib/index.html)

::::::{.columns}
::::: {.column width="48%"}
[![](images/bslib-card-1.png){fig-align="center"}](https://rstudio.github.io/bslib/index.html)
:::::
::::: {.column width="48%"}
[![](images/bslib-card-2.png){fig-align="center"}](https://rstudio.github.io/bslib/index.html)
:::::
::::::
:::

::::

## Cards in bslib

::::{.columns}
::: {.column width="36%"}
Cards are a really useful way to help individual content stand-out and support all sorts of things like captions and inline sidebars.
:::
::: {.column width="64%"}
```{r echo=TRUE, eval=TRUE}
bslib::card(
  bslib::card_header(
    "A car's economy is inversely proportional to its weight."
  ),
  bslib::card_body(example_plot_a),
  bslib::card_footer(
    "The plot shows economy versus weight for a set of cars provided by the
    mtcars data set."
  )
)
```
:::
::::

## Organising columns in bslib

::::{.columns}
::: {.column width="36%"}
Layouts can be handled a little bit differently when using `bslib` compared to the normal `shiny` method. Instead of having a `column()` entry for each column, you can use `layout_columns()` as one container for a set of columns. This can reduce the levels of bracket Armageddon in your code, but also provides better dynamic response to changing screen / browser window sizes.
:::
::: {.column width="64%"}
```{r echo=TRUE, eval=TRUE}
layout_columns(
  bslib::card(
    bslib::card_header(
      "A car's economy is inversely proportional to its weight."
    ),
    bslib::card_body(example_plot_a)
  ),
  bslib::card(
    bslib::card_header(
      "The sample is a little biased towards lower economy cars."
    ),
    bslib::card_body(example_plot_b)
  )
)
```
:::
::::


## Valueboxes in bslib

::::{.columns}
::: {.column width="36%"}
Quite a few of our dashboards use `shinydashboard`, but will hopefully have noticed a warning message saying it's no longer maintained (it hasn't been updated for 3 years now). One of the main reasons analysts use `shinydashboard` is for **valueboxes** and `bslib` provides an up to date alternative to use instead.
:::
::: {.column width="64%"}
```{r echo=TRUE, eval=TRUE}
layout_columns(
  bslib::value_box(
    title = "1st value",
    value = "123",
    showcase = bsicons::bs_icon("bar-chart"),
    p("The 1st detail"),
    theme = "orange"
  ),
  bslib::value_box(
    title = "2nd value",
    value = "234.234",
    showcase = bsicons::bs_icon("graph-up"),
    p("The 1st detail"),
    theme = "orange"
  )
)
```
:::
::::

## Accordions in bslib

::::{.columns}
::: {.column width="36%"}
Quite a few of our dashboards use `shinydashboard`, but will hopefully have noticed a warning message saying it's no longer maintained (it hasn't been updated for 3 years now). One of the main reasons analysts use `shinydashboard` is for **valueboxes** and `bslib` provides an up to date alternative to use instead.
:::
::: {.column width="64%"}
```{r echo=TRUE, eval=FALSE}
      bslib::accordion(
        bslib::accordion_panel("Section A", example_plot_a),
        bslib::accordion_panel("Section B", example_plot_b)
      )
```
![](images/accordions-preview.png)
:::
::::

## Demo dashboard

::::{.columns}
::: {.column width="36%"}
I've created a very small [demo dashboard in Coffee and Coding repository](https://github.com/dfe-analytical-services/coffee-and-coding/blob/bielbyr-bslib/2024-07-02-bslib/app.R) if anyone wants to have an explore of the code in situ.
![](images/app-preview.png)
:::
::: {.column width="64%"}
```{r echo=TRUE, eval=FALSE}
ui <- page_fluid(
  shinyGovstyle::header(
    main_text = "",
    main_link = "https://www.gov.uk/government/organisations/department-for-education",
    secondary_text = "Coffee and Coding demo",
    logo = "https://department-for-education.shinyapps.io/pupil-attendance-in-schools/_w_6d98db03/images/DfE_logo_landscape.png",
    logo_width = 150,
    logo_height = 32
  ),
  shiny::navlistPanel(
    "",
    id = "navlistPanel",
    widths = c(2, 8),
    well = FALSE,
    cards_columns(),
    valueboxes(),
    accordions()
  ),
  footer(full = TRUE)
)
```
:::
::::

